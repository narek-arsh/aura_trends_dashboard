name: Collect Trends

on:
  workflow_dispatch:
  schedule:
    - cron: "0 8,18 * * *"

jobs:
  collect:
    runs-on: ubuntu-latest

    env:
      GEMINI_API_KEYS: ${{ secrets.GEMINI_API_KEYS }}   # "KEY1,KEY2,KEY3"
      GEMINI_API_KEY:  ${{ secrets.GEMINI_API_KEY }}    # (opcional: fallback)
      # (Opcional) Ajusta ritmo:
      # GEMINI_SECONDS_PER_CALL: "10"     # 10s por petici√≥n y por clave (muy conservador)
      # GEMINI_RPM_PER_KEY: "6"           # 6 peticiones/minuto por clave

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.10"

      - name: Install dependencies
        run: |
          pip install -r requirements.txt

      - name: Run trend collector
        run: python trend_probe.py
